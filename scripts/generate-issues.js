/**
 * GitHub Issues自動生成スクリプト
 *
 * 使い方:
 * node scripts/generate-issues.js
 */

const fs = require('fs');
const path = require('path');

// Issue データ定義（Phase 1: 応募者マイページMVP）
const issuesData = [
  {
    number: 5,
    title: 'React初期化とルーティング設定',
    phase: 0,
    labels: ['frontend', 'setup', 'phase-0'],
    dependencies: ['#1'],
    background: 'Walking Skeleton実装のため、React RouterとReact Hook Form、共通レイアウトを設定する。認証状態管理とルーティングの基盤を確立することで、後続の画面実装をスムーズに進められる。',
    scope: `### React Router設定
- [ ] React Router v6 インストール・設定
- [ ] ルート定義（/login, /dashboard, /applicant/*, /agent/*）
- [ ] プライベートルート（認証必須）の実装
- [ ] 公開ルート（/login）の実装

### 状態管理
- [ ] Context API または Redux Toolkit で認証状態管理
- [ ] ログイン状態の永続化（LocalStorage）
- [ ] 認証トークンの管理

### 共通レイアウト
- [ ] Header コンポーネント作成
- [ ] Sidebar コンポーネント作成
- [ ] Footer コンポーネント作成
- [ ] レイアウトコンポーネント作成

### Axios設定
- [ ] Axios インスタンス作成
- [ ] ベースURL設定（環境変数）
- [ ] インターセプター設定（認証トークン自動付与）
- [ ] エラーハンドリング`,
    ac: [
      'React Router v6 がインストール・設定され、ルーティングが動作する',
      'Context API または Redux Toolkit で認証状態管理が実装されている',
      '共通レイアウトコンポーネント（Header, Sidebar, Footer）が作成されている',
      'プライベートルート（認証必須）が実装され、未認証時に/loginへリダイレクトする',
      '公開ルート（/login）と認証後ルート（/dashboard）が分離されている',
      'Bootstrap テンプレートが導入され、基本的なUIが整っている',
      'Axios インスタンスが設定され、ベースURLとインターセプターが動作する'
    ]
  },
  {
    number: 6,
    title: 'フロントエンド・バックエンドAPI接続確認',
    phase: 0,
    labels: ['frontend', 'backend', 'integration', 'phase-0'],
    dependencies: ['#3', '#5'],
    background: 'フロントエンドとバックエンドが独立して実装されたため、API接続を確認しCORS設定を行う。エンドツーエンドの通信が確立されることで、Walking Skeletonの動線が完成する。',
    scope: `### CORS設定
- [ ] バックエンドで CORS 設定
- [ ] 開発環境: localhost:5173 許可
- [ ] 本番環境: 本番ドメイン許可

### API接続テスト
- [ ] Axios で GET /api/v1/auth/me 呼び出し
- [ ] ログイン後の認証トークン保存（Cookie）
- [ ] 認証トークンの自動付与（インターセプター）

### エラーハンドリング
- [ ] APIエラー時のエラーメッセージ表示
- [ ] ネットワークエラー時のフォールバック
- [ ] 401エラー時の自動ログアウト

### 環境変数管理
- [ ] 開発環境・本番環境のベースURL切り替え
- [ ] proxy設定または環境変数でURL管理`,
    ac: [
      'バックエンドで CORS 設定が完了し、開発環境（localhost:5173）からのアクセスが許可される',
      'Axios で GET /api/v1/auth/me が成功し、ユーザー情報が取得できる',
      'ログイン後に認証トークンがCookieに保存され、次回リクエストで自動付与される',
      'API エラー時にフロントエンドでエラーメッセージが表示される',
      '開発環境で proxy 設定または環境変数でベースURLが管理されている',
      'ブラウザ開発者ツールでネットワーク通信を確認し、正常に動作している'
    ]
  },
  {
    number: 7,
    title: 'Firebase Hostingへのデプロイ（開発環境）',
    phase: 0,
    labels: ['infra', 'deployment', 'phase-0'],
    dependencies: ['#4', '#6'],
    background: 'Walking Skeletonが完成したため、Firebase Hostingにデプロイして動作確認を行う。デプロイフローを確立することで、継続的なデプロイとチーム全体での動作確認が可能になる。',
    scope: `### Firebase Hosting設定
- [ ] Firebase CLI インストール
- [ ] firebase init hosting 実行
- [ ] public ディレクトリ設定（dist/）
- [ ] ビルドコマンド設定

### ビルド設定
- [ ] 本番ビルドコマンド（npm run build）確認
- [ ] 環境変数の本番設定
- [ ] ビルド成果物の確認

### デプロイ
- [ ] firebase deploy --only hosting 実行
- [ ] デプロイURL確認
- [ ] 本番環境での動作確認

### ドキュメント
- [ ] デプロイ手順のドキュメント化
- [ ] ロールバック手順のドキュメント化`,
    ac: [
      'Firebase CLI がインストールされ、firebase init hosting が完了している',
      'ビルドコマンド（npm run build）が成功し、dist/ディレクトリにビルド成果物が生成される',
      'Firebase Hosting にデプロイされ、デプロイURLでアクセスできる',
      'デプロイされたURLでログイン画面が表示され、ログイン機能が動作する',
      '本番ビルドで環境変数が正しく読み込まれ、Firebase APIキーが設定されている',
      'デプロイ手順がdocs/またはREADME.mdにドキュメント化されている'
    ]
  },
  // Phase 1: 応募者マイページMVP
  {
    number: 10,
    title: 'プロフィール閲覧画面UI実装',
    phase: 1,
    labels: ['frontend', 'applicant', 'phase-1'],
    dependencies: ['#9'],
    background: '応募者マイページでプロフィール情報を表示する画面を実装する。応募者が自身の登録情報を確認できるようにし、マイページの基本機能を提供する。',
    scope: `### プロフィール画面UI
- [ ] プロフィール画面（/applicant/profile）作成
- [ ] GET /api/v1/applicant/me からデータ取得
- [ ] 氏名、電話番号、住所、生年月日、職歴、スキル等の表示
- [ ] レスポンシブデザイン（PC・スマホ対応）
- [ ] ローディング状態とエラー状態の表示
- [ ] 編集ボタンから編集画面へ遷移`,
    ac: [
      'プロフィール画面（/applicant/profile）が表示される',
      'GET /api/v1/applicant/me からデータを取得して表示される',
      '氏名、電話番号、住所、生年月日、職歴、スキル等が適切に表示される',
      'レスポンシブデザインでPC・スマホの両方で正しく表示される',
      'ローディング状態とエラー状態が適切に表示される',
      '編集ボタンをクリックすると編集画面へ遷移する'
    ]
  },
  {
    number: 11,
    title: 'プロフィール編集機能UI実装',
    phase: 1,
    labels: ['frontend', 'applicant', 'phase-1'],
    dependencies: ['#10'],
    background: '応募者が自身の情報を編集できるフォーム画面を実装する。情報の更新を可能にすることで、応募者が常に最新の情報を維持できるようにする。',
    scope: `### プロフィール編集画面
- [ ] プロフィール編集画面（/applicant/profile/edit）作成
- [ ] 各フィールドが編集可能なフォームとして表示
- [ ] 保存ボタンクリックで PUT /api/v1/applicant/me を呼び出し
- [ ] 保存成功時にトーストメッセージ表示
- [ ] 保存失敗時にエラーメッセージ表示
- [ ] キャンセルボタンで閲覧画面に戻る`,
    ac: [
      'プロフィール編集画面（/applicant/profile/edit）が表示される',
      '各フィールドが編集可能なフォームとして表示される',
      '保存ボタンクリックで PUT /api/v1/applicant/me が呼び出される',
      '保存成功時にトーストメッセージが表示される',
      '保存失敗時にエラーメッセージが表示される',
      'キャンセルボタンで閲覧画面に戻る'
    ]
  },
  {
    number: 12,
    title: '入力バリデーション実装（フロント・バックエンド）',
    phase: 1,
    labels: ['frontend', 'backend', 'validation', 'phase-1'],
    dependencies: ['#11', '#9'],
    background: 'フロントエンドとバックエンドの両方でバリデーションを実装する。二重のバリデーションにより、データの整合性とセキュリティを確保する。',
    scope: `### フロントエンドバリデーション
- [ ] React Hook Form でバリデーション実装
- [ ] 必須項目チェック（氏名、電話番号、生年月日）
- [ ] 電話番号形式チェック（10-11桁数字）
- [ ] メールアドレス形式チェック
- [ ] エラーメッセージ表示

### バックエンドバリデーション
- [ ] express-validator でバリデーション実装
- [ ] 必須項目チェック
- [ ] 形式チェック
- [ ] バリデーションエラーレスポンス（400）

### ドキュメント
- [ ] バリデーションルールのドキュメント化`,
    ac: [
      'フロントエンド: React Hook Form でバリデーションが実装されている',
      '必須項目チェック（氏名、電話番号、生年月日）が動作する',
      '電話番号形式チェック（10-11桁数字）が動作する',
      'メールアドレス形式チェックが動作する',
      'バックエンド: express-validator でバリデーションが実装されている',
      'バリデーションエラー時に適切なエラーメッセージが表示される',
      'バリデーションルールがドキュメント化されている'
    ]
  },
  {
    number: 13,
    title: 'パスワード変更機能実装',
    phase: 1,
    labels: ['backend', 'frontend', 'auth', 'phase-1'],
    dependencies: ['#9'],
    background: '応募者がパスワードを変更できる機能を実装する。セキュリティを確保するため、現在のパスワード確認とパスワードポリシーを適用する。',
    scope: `### パスワード変更API
- [ ] PUT /api/v1/auth/password エンドポイント実装
- [ ] 現在のパスワード、新しいパスワード、確認用パスワードを受け取る
- [ ] パスワードポリシー（8文字以上、英数字記号含む）のバリデーション
- [ ] Firebase Authentication でパスワード更新
- [ ] セキュリティログに記録

### パスワード変更画面
- [ ] パスワード変更画面UI実装（/applicant/settings/password）
- [ ] 変更成功時にログアウトして再ログイン促す`,
    ac: [
      'PUT /api/v1/auth/password エンドポイントが実装されている',
      '現在のパスワード、新しいパスワード、確認用パスワードを受け取る',
      'パスワードポリシー（8文字以上、英数字記号含む）のバリデーションが動作する',
      'Firebase Authentication でパスワードが更新される',
      'パスワード変更画面UI（/applicant/settings/password）が実装されている',
      '変更成功時にログアウトして再ログインを促すメッセージが表示される',
      'セキュリティログに記録される'
    ]
  },
  {
    number: 14,
    title: 'セキュリティ設定画面実装',
    phase: 1,
    labels: ['frontend', 'applicant', 'security', 'phase-1'],
    dependencies: ['#13'],
    background: '最終ログイン日時、セッション管理などセキュリティ情報を表示する画面を実装する。応募者が自身のアカウントのセキュリティ状態を確認できるようにする。',
    scope: `### セキュリティ設定画面
- [ ] セキュリティ設定画面（/applicant/settings/security）作成
- [ ] 最終ログイン日時表示
- [ ] パスワード変更へのリンク
- [ ] アカウント削除ボタン（確認ダイアログ付き）
- [ ] セッション一覧表示（将来的な拡張のためのプレースホルダー）`,
    ac: [
      'セキュリティ設定画面（/applicant/settings/security）が表示される',
      '最終ログイン日時が表示される',
      'パスワード変更へのリンクが表示される',
      'アカウント削除ボタンが表示され、確認ダイアログが表示される',
      'セッション一覧表示のプレースホルダーが表示される'
    ]
  },
  {
    number: 15,
    title: 'レスポンシブデザイン対応（応募者画面）',
    phase: 1,
    labels: ['frontend', 'ui', 'responsive', 'phase-1'],
    dependencies: ['#10', '#11', '#14'],
    background: '応募者マイページの全画面をスマホ・タブレット対応にする。モバイルデバイスからのアクセスを考慮し、快適な操作性を提供する。',
    scope: `### レスポンシブ対応
- [ ] iPhone SE (375px) で全画面が正しく表示される
- [ ] タブレット (768px) で全画面が正しく表示される
- [ ] PC (1024px以上) で全画面が正しく表示される
- [ ] ハンバーガーメニューがスマホで動作する
- [ ] フォーム入力が各デバイスで快適に操作できる
- [ ] 画像・テキストのサイズが適切に調整されている
- [ ] ブラウザ開発者ツールでデバイスエミュレート確認`,
    ac: [
      'iPhone SE (375px) で全画面が正しく表示される',
      'タブレット (768px) で全画面が正しく表示される',
      'PC (1024px以上) で全画面が正しく表示される',
      'ハンバーガーメニューがスマホで動作する',
      'フォーム入力が各デバイスで快適に操作できる',
      '画像・テキストのサイズが適切に調整されている',
      'ブラウザ開発者ツールでデバイスエミュレート確認済み'
    ]
  },
  {
    number: 16,
    title: '応募者機能E2Eテスト',
    phase: 1,
    labels: ['test', 'e2e', 'applicant', 'phase-1'],
    dependencies: ['#15'],
    background: '応募者マイページの主要機能をE2Eテストで検証する。全体の動線が正しく動作することを確認し、品質を保証する。',
    scope: `### E2Eテストシナリオ
- [ ] ログイン→プロフィール閲覧のテスト
- [ ] プロフィール編集→保存のテスト
- [ ] パスワード変更のテスト
- [ ] バリデーションエラー表示のテスト
- [ ] レスポンシブデザインのテスト（スマホ・PC）
- [ ] 全テストが CI/CD パイプラインで実行される`,
    ac: [
      'ログイン→プロフィール閲覧のテストが成功する',
      'プロフィール編集→保存のテストが成功する',
      'パスワード変更のテストが成功する',
      'バリデーションエラー表示のテストが成功する',
      'レスポンシブデザインのテスト（スマホ・PC）が成功する',
      '全テストが CI/CD パイプラインで実行される'
    ]
  },
  // Phase 2: エージェント管理画面MVP
  {
    number: 17,
    title: 'エージェント権限管理実装',
    phase: 2,
    labels: ['backend', 'auth', 'agent', 'phase-2'],
    dependencies: ['#3'],
    background: 'エージェント専用のルートと権限チェックミドルウェアを実装する。役割ベースのアクセス制御により、応募者とエージェントの権限を分離する。',
    scope: `### 権限チェックミドルウェア
- [ ] 認証ミドルウェアで role=agent のチェック実装
- [ ] エージェント専用APIエンドポイントが role=applicant でアクセス不可
- [ ] 403 Forbidden エラーレスポンス

### フロントエンド
- [ ] フロントエンドで role に応じたルーティング分岐
- [ ] エージェントダッシュボード（/agent/dashboard）の初期画面作成
- [ ] 権限エラー時のエラーページ表示`,
    ac: [
      '認証ミドルウェアで role=agent のチェックが実装されている',
      'エージェント専用APIエンドポイントが role=applicant でアクセス不可',
      '403 Forbidden エラーが適切に返される',
      'フロントエンドで role に応じたルーティング分岐が実装されている',
      'エージェントダッシュボード（/agent/dashboard）の初期画面が作成されている',
      '権限エラー時のエラーページが表示される'
    ]
  },
  {
    number: 18,
    title: '応募者一覧取得API実装',
    phase: 2,
    labels: ['backend', 'api', 'agent', 'phase-2'],
    dependencies: ['#17'],
    background: 'エージェントが応募者一覧を取得できるAPIエンドポイントを実装する。ページネーション、フィルタリング、ソート機能を提供する。',
    scope: `### 応募者一覧API
- [ ] GET /api/v1/agent/applicants エンドポイント実装
- [ ] クエリパラメータ（page, limit, status, sort_by）に対応
- [ ] ページネーション実装（デフォルト20件/ページ）
- [ ] ステータスフィルタリング機能
- [ ] ソート機能（name, created_at, updated_at）
- [ ] レスポンスに pagination 情報含む
- [ ] API仕様書と整合性確認`,
    ac: [
      'GET /api/v1/agent/applicants エンドポイントが実装されている',
      'クエリパラメータ（page, limit, status, sort_by）に対応している',
      'ページネーションが実装されている（デフォルト20件/ページ）',
      'ステータスフィルタリング機能が動作する',
      'ソート機能（name, created_at, updated_at）が動作する',
      'レスポンスに pagination 情報が含まれている',
      'API仕様書と整合性がある'
    ]
  },
  {
    number: 19,
    title: '応募者一覧画面UI実装',
    phase: 2,
    labels: ['frontend', 'agent', 'phase-2'],
    dependencies: ['#18'],
    background: 'エージェント管理画面で応募者一覧を表示するテーブルを実装する。フィルタリング、ソート、ページネーション機能を提供する。',
    scope: `### 一覧画面UI
- [ ] 応募者一覧画面（/agent/applicants）作成
- [ ] テーブル形式で応募者情報（氏名、メール、ステータス、登録日）を表示
- [ ] ページネーションコンポーネント実装
- [ ] ステータスフィルタ（ドロップダウン）実装
- [ ] ソートボタン（氏名、登録日）実装
- [ ] 詳細ボタンクリックで詳細画面へ遷移
- [ ] レスポンシブデザイン（スマホではカード表示）`,
    ac: [
      '応募者一覧画面（/agent/applicants）が表示される',
      'テーブル形式で応募者情報（氏名、メール、ステータス、登録日）が表示される',
      'ページネーションコンポーネントが動作する',
      'ステータスフィルタ（ドロップダウン）が動作する',
      'ソートボタン（氏名、登録日）が動作する',
      '詳細ボタンクリックで詳細画面へ遷移する',
      'レスポンシブデザイン（スマホではカード表示）が実装されている'
    ]
  },
  {
    number: 20,
    title: '応募者詳細画面UI実装',
    phase: 2,
    labels: ['frontend', 'agent', 'phase-2'],
    dependencies: ['#18'],
    background: 'エージェントが応募者の詳細情報を閲覧できる画面を実装する。個人情報、職歴、スキルなどの詳細情報を表示する。',
    scope: `### 詳細取得API
- [ ] GET /api/v1/agent/applicants/:id エンドポイント実装

### 詳細画面UI
- [ ] 応募者詳細画面（/agent/applicants/:id）作成
- [ ] 個人情報、職歴、スキル、資格、自己PR等を表示
- [ ] ステータス変更ドロップダウン（将来機能のためのプレースホルダー）
- [ ] 編集ボタンから編集画面へ遷移
- [ ] 一覧へ戻るボタン`,
    ac: [
      'GET /api/v1/agent/applicants/:id エンドポイントが実装されている',
      '応募者詳細画面（/agent/applicants/:id）が表示される',
      '個人情報、職歴、スキル、資格、自己PR等が表示される',
      'ステータス変更ドロップダウンのプレースホルダーが表示される',
      '編集ボタンから編集画面へ遷移する',
      '一覧へ戻るボタンが動作する'
    ]
  },
  {
    number: 21,
    title: 'エージェント用応募者情報編集機能実装',
    phase: 2,
    labels: ['backend', 'frontend', 'agent', 'phase-2'],
    dependencies: ['#20'],
    background: 'エージェントが応募者情報を編集できる機能を実装する。編集ログを記録し、将来的に応募者への通知機能を提供する準備をする。',
    scope: `### 編集API
- [ ] PUT /api/v1/agent/applicants/:id エンドポイント実装
- [ ] バリデーション実装
- [ ] 活動履歴に編集ログ記録

### 編集画面UI
- [ ] 応募者編集画面（/agent/applicants/:id/edit）作成
- [ ] 全フィールドが編集可能
- [ ] 保存成功時にトーストメッセージ表示
- [ ] 応募者本人には編集通知送信（将来機能のプレースホルダー）`,
    ac: [
      'PUT /api/v1/agent/applicants/:id エンドポイントが実装されている',
      '応募者編集画面（/agent/applicants/:id/edit）が表示される',
      '全フィールドが編集可能',
      'バリデーションが動作する',
      '保存成功時にトーストメッセージが表示される',
      '活動履歴に編集ログが記録される',
      '応募者本人への編集通知のプレースホルダーが用意されている'
    ]
  },
  {
    number: 22,
    title: 'フィルタ・ソート機能強化',
    phase: 2,
    labels: ['frontend', 'backend', 'agent', 'phase-2'],
    dependencies: ['#19'],
    background: '応募者一覧画面のフィルタ・ソート機能を強化する。複数条件でのフィルタリングと、URLクエリパラメータによる状態管理を実装する。',
    scope: `### フィルタ機能強化
- [ ] 複数ステータス同時フィルタ（チェックボックス）
- [ ] 登録日範囲フィルタ（日付ピッカー）
- [ ] フリーワード検索（氏名・メール部分一致）
- [ ] ソート順の昇順・降順切り替え
- [ ] フィルタ・ソート条件がURLクエリパラメータに反映
- [ ] ブラウザバック時にフィルタ状態が保持される
- [ ] フィルタリセットボタン`,
    ac: [
      '複数ステータス同時フィルタ（チェックボックス）が動作する',
      '登録日範囲フィルタ（日付ピッカー）が動作する',
      'フリーワード検索（氏名・メール部分一致）が動作する',
      'ソート順の昇順・降順切り替えが動作する',
      'フィルタ・ソート条件がURLクエリパラメータに反映される',
      'ブラウザバック時にフィルタ状態が保持される',
      'フィルタリセットボタンが動作する'
    ]
  },
  {
    number: 23,
    title: 'ページネーション実装',
    phase: 2,
    labels: ['frontend', 'agent', 'phase-2'],
    dependencies: ['#19'],
    background: '応募者一覧のページネーションを実装する。大量データの効率的な表示と、ユーザビリティを向上させる。',
    scope: `### ページネーション機能
- [ ] ページ番号ボタン表示（1, 2, 3, ...）
- [ ] 前へ・次へボタン実装
- [ ] 現在ページのハイライト表示
- [ ] 総ページ数・総件数表示
- [ ] ページあたり件数変更（10, 20, 50）
- [ ] URLクエリパラメータ（?page=2）対応
- [ ] 最終ページで「次へ」ボタン無効化`,
    ac: [
      'ページ番号ボタンが表示される（1, 2, 3, ...）',
      '前へ・次へボタンが動作する',
      '現在ページがハイライト表示される',
      '総ページ数・総件数が表示される',
      'ページあたり件数変更（10, 20, 50）が可能',
      'URLクエリパラメータ（?page=2）に対応している',
      '最終ページで「次へ」ボタンが無効化される'
    ]
  },
  {
    number: 24,
    title: 'エージェント機能E2Eテスト',
    phase: 2,
    labels: ['test', 'e2e', 'agent', 'phase-2'],
    dependencies: ['#23'],
    background: 'エージェント管理画面の主要機能をE2Eテストで検証する。全体のワークフローが正しく動作することを確認する。',
    scope: `### E2Eテストシナリオ
- [ ] エージェントログイン→一覧表示のテスト
- [ ] フィルタ・ソート機能のテスト
- [ ] ページネーションのテスト
- [ ] 応募者詳細表示のテスト
- [ ] 応募者編集→保存のテスト
- [ ] 権限エラー（応募者がエージェント画面にアクセス）のテスト`,
    ac: [
      'エージェントログイン→一覧表示のテストが成功する',
      'フィルタ・ソート機能のテストが成功する',
      'ページネーションのテストが成功する',
      '応募者詳細表示のテストが成功する',
      '応募者編集→保存のテストが成功する',
      '権限エラー（応募者がエージェント画面にアクセス）のテストが成功する'
    ]
  }
];

// Issueテンプレート生成関数
function generateIssueMarkdown(issue) {
  const deps = issue.dependencies.join(', ');
  const labels = issue.labels.map(l => `\`${l}\``).join(', ');
  const acList = issue.ac.map(ac => `- [ ] ${ac}`).join('\n');

  return `# Issue #${issue.number}: ${issue.title}

## 背景 / 目的
${issue.background}

- **依存**: ${deps}
- **ラベル**: ${labels}

## スコープ / 作業項目

${issue.scope}

## ゴール / 完了条件（Acceptance Criteria）

${acList}

## テスト観点

### 検証方法
（実装時に詳細化）

## 要確認事項

（必要に応じて追加）

## 参考資料

- [実装計画](../docs/08_implementation_plan.md)
- [要件定義書](../docs/01_requirements.md)
- [アーキテクチャ設計書](../docs/02_architecture.md)
`;
}

// Issues生成
const issuesDir = path.join(__dirname, '..', '.github', 'ISSUES');

issuesData.forEach(issue => {
  const filename = `issue-${String(issue.number).padStart(3, '0')}.md`;
  const filepath = path.join(issuesDir, filename);
  const content = generateIssueMarkdown(issue);

  fs.writeFileSync(filepath, content, 'utf8');
  console.log(`✓ Generated ${filename}`);
});

console.log(`\n${issuesData.length} issues generated successfully!`);
